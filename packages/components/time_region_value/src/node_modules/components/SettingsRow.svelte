<script>
	import Icon from '@svizzle/ui/src/icons/Icon.svelte';
	import ChevronDown from '@svizzle/ui/src/icons/feather/ChevronDown.svelte';
	import ChevronUp from '@svizzle/ui/src/icons/feather/ChevronUp.svelte';
	import Globe from '@svizzle/ui/src/icons/feather/Globe.svelte';
	import Switch from '@svizzle/ui/src/Switch.svelte';

	import sharedTheme from 'theme';

	const defaultTheme = {
		colorRef: sharedTheme.colorRef,
		colorSelected: sharedTheme.colorSelected,
	};
	const defaultHandlers = {
		toggledColorScheme: null,
		toggledFiltering: null,
		toggledGeoModal: null,
		toggledRanking: null,
	}

	export let colorScheme = {
		value: 'Red-Blue',
		values: ['Red-Blue', 'Green-Blue']
	}
	export let flags = {
		doFilter: false,
		isGeoModalVisible: false,
		showRankingControl: false,
		someUnselectedRegions: false,
	}
	export let handlers = defaultHandlers;
	export let theme = {
		colorRef: defaultTheme.colorRef,
		colorSelected: defaultTheme.colorSelected,
	}

	// FIXME https://github.com/sveltejs/svelte/issues/4442
	$: handlers = handlers ? {...defaultHandlers, ...handlers} : defaultHandlers;
	$: theme = theme ? {...defaultTheme, ...theme} : defaultTheme;

	$: globeStroke =
		flags.someUnselectedRegions ? theme.colorSelected : theme.colorRef;
</script>

<div class='SettingsRow'>
	<!-- geo selection -->
	<div class='optgroup'>
		<div
			class='globe clickable'
			on:click={handlers.toggledGeoModal}
		>
			<Icon
				glyph={Globe}
				size={28}
				stroke={globeStroke}
				strokeWidth={1.5}
			/>
			<Icon
				glyph={flags.isGeoModalVisible ? ChevronUp : ChevronDown}
				size={24}
				strokeWidth={1}
			/>
		</div>

		<Switch
			value={flags.doFilter ? 'Filter' : 'Highlight'}
			values={['Highlight', 'Filter']}
			on:toggled={handlers.toggledFiltering}
		/>
	</div>

	<!-- ranking -->
	{#if flags.showRankingControl}
		<div class='optgroup'>
			<Switch
				value='Absolute'
				values={['Absolute', 'Ranking']}
				on:toggled={handlers.toggledRanking}
			/>
		</div>
	{/if}

	<!-- color scale -->
	<div class='optgroup'>
		<Switch
			value={colorScheme.value}
			values={colorScheme.values}
			on:toggled={handlers.toggledColorScheme}
		/>
	</div>
</div>

<style>
	.SettingsRow {
		align-items: center;
		display: flex;
		height: 100%;
		justify-content: space-between;
		width: 100%;
	}
	.SettingsRow > div:not(:last-child) {
		margin-right: 0.5rem;
	}

	.globe {
		border: 1px solid var(--colorRefLight);
		margin-right: 0.25rem;
		padding: 0.25rem;
	}
	.optgroup {
		display: flex;
		align-items: center;
		padding: 0.25rem;
	}

	.clickable {
		cursor: pointer;
	}
</style>
