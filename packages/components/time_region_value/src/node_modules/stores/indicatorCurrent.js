import {isIterableEmpty} from '@svizzle/utils';
import {extent} from 'd3-array';
import * as _ from 'lamb';
import {derived} from 'svelte/store';

import {
	_getIndicatorValue,
	_selectionData,
	_yearSelectionData,
} from 'stores/indicator';
import {_selectedYear} from 'stores/selectedYear';
import {isValidExtent} from 'utils/d3';

/* current data */

const _currentData = derived(
	[_selectedYear, _selectionData, _yearSelectionData],
	([selectedYear, selectionData, yearSelectionData]) =>
		selectedYear ? yearSelectionData : selectionData,
);

export const _isCurrentDataEmpty = derived(_currentData, isIterableEmpty);

/* extent */

export const _currentExtext = derived(
	[_getIndicatorValue, _currentData],
	([getIndicatorValue, currentData]) => extent(currentData, getIndicatorValue)
);

export const _isExtentValid = derived(_currentExtext, isValidExtent);
